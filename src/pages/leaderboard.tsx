import Head from "next/head"
import Image from "next/image"
import { useState } from "react"
import { trpc } from "../utils/trpc"
import Capitals from "../../assets/category-icons/capitals.png"
import Flags from "../../assets/category-icons/flags.png"
import Timezones from "../../assets/category-icons/timezones.png"
import Area from "../../assets/category-icons/area.png"
import Population from "../../assets/category-icons/population.png"
import All from "../../assets/quiz-icons/all.png"

const Leaderboard = () => {
    const allScores = trpc.getAllScores.useQuery().data
    const [category, setCategory] = useState<string>("all")
    const [stats, setStats] = useState<string>("none")

    if (allScores === undefined) {
        return (
            <div className="flex justify-center pt-4">
                Loading...
            </div>
        )
    }

    const tableItem = "w-16 md:w-40"
    const tableHeading = `font-bold ${tableItem}`
    const filterItem = "flex items-center border-y-2 border-l-2 border-gray-700 p-2 cursor-pointer hover:bg-gray-700"
    
    let displayLeaderboard = allScores

    if (category !== "all") {
        displayLeaderboard = allScores.filter((entry: any) => entry.quiz === category)
    }

    if (stats !== "none") {
        displayLeaderboard = displayLeaderboard.sort((a: any, b:any) => a[stats] - b[stats]).reverse()
    }

    return (
        <div className="flex justify-center">
            <Head>
                <title>GeoQuix | Leaderboard</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <main className="flex flex-col items-center py-4 gap-4 relative">
                <h2>Sort By</h2>
                <ul className="flex">
                    <li
                        onClick={() => setCategory("all")}
                        className={filterItem}
                        style={category === "all" ? {backgroundColor: "#374151"} : {backgroundColor: "inherit"}}>
                        <Image
                            src={All}
                            alt="All Icon"
                            width={30}
                            height={30}
                        />
                    </li>
                    <li
                        onClick={() => setCategory("capitals")}
                        className={filterItem}
                        style={category === "capitals" ? {backgroundColor: "#374151"} : {backgroundColor: "inherit"}}>
                        <Image
                            src={Capitals}
                            alt="Capitals Icon"
                            width={30}
                            height={30}
                        />
                    </li>
                    <li
                        onClick={() => setCategory("flags")}
                        className={filterItem}
                        style={category === "flags" ? {backgroundColor: "#374151"} : {backgroundColor: "inherit"}}>
                        <Image
                            src={Flags}
                            alt="Flags Icon"
                            width={30}
                            height={30}
                        />
                    </li>
                    <li
                        onClick={() => setCategory("timezones")}
                        className={filterItem}
                        style={category === "timezones" ? {backgroundColor: "#374151"} : {backgroundColor: "inherit"}}>
                        <Image
                            src={Timezones}
                            alt="Timezones Icon"
                            width={30}
                            height={30}
                        />
                    </li>
                    <li
                        onClick={() => setCategory("area")}
                        className={filterItem}
                        style={category === "area" ? {backgroundColor: "#374151"} : {backgroundColor: "inherit"}}>
                        <Image
                            src={Area}
                            alt="Area Icon"
                            width={30}
                            height={30}
                        />
                    </li>
                    <li
                        onClick={() => setCategory("population")}
                        className={`${filterItem} border-r-2`}
                        style={category === "population" ? {backgroundColor: "#374151"} : {backgroundColor: "inherit"}}>
                        <Image
                            src={Population}
                            alt="Population Icon"
                            width={30}
                            height={30}
                        />
                    </li>
                </ul>

                <ul className="flex">
                    <li onClick={() => setStats("none")} className={filterItem}>NONE</li>
                    <li onClick={() => setStats("score")} className={filterItem}>SCORE</li>
                    <li onClick={() => setStats("accuracy")} className={`${filterItem} border-r-2`}>ACC.</li>
                </ul>

                <div className="border-b-2 border-gray-700 flex gap-4 pb-2">
                    <p className={tableHeading}>Name</p>
                    <p className={tableHeading}>Score</p>
                    <p className={tableHeading}>Acc.</p>
                    <p className={tableHeading}>Quiz</p>
                </div>

                {displayLeaderboard.map((entry: any) => {
                    const { id, name, score, accuracy, quiz } = entry

                    let displayQuiz = quiz.substring(0, 3).toUpperCase()
                    
                    if (quiz === "area" || quiz === "flags" || quiz === "timezones") {
                        displayQuiz = quiz.substring(0, 4).toUpperCase()
                    }
                        
                    return (
                        <div
                            className="flex gap-4"
                            key={id}>
                            <p className={tableItem}>{name.toUpperCase()}</p>
                            <p className={tableItem}>{score}</p>
                            <p className={tableItem}>{accuracy}</p>
                            <p className={tableItem}>{displayQuiz}</p>
                        </div>
                    )
                })
                }
            </main>

        </div>
    )
}

export default Leaderboard
